<!-- Display GoatCounter pageviews -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const pv = document.getElementById('pageviews');

    if (pv !== null) {
      const uri = location.pathname.replace(/\/$/, '');
      const url = `https://{{ site.analytics.goatcounter.id }}.goatcounter.com/counter/${encodeURIComponent(uri)}.json`;

      fetch(url)
        .then((response) => response.json())
        .then((data) => {
          const count = parseInt(data.count.replace(/\D/g, ''));
          if (count > 100) {
            pv.innerText = new Intl.NumberFormat().format(count);
          } else {
            // Hide the entire pageviews section if count <= 100
            pv.parentElement.style.display = 'none';
          }
        })
        .catch((error) => {
          // Hide the pageviews section on error as well since we don't know the count
          pv.parentElement.style.display = 'none';
          console.debug('GoatCounter pageviews fetch error:', error);
        });
    }
  });
</script>
